
# Документация по смарт-контракту P2P Escrow

Этот документ служит указателем на полную документацию смарт-контракта P2P Escrow.

## Обзор документации

Документация организована по следующим файлам:

1. [README.md](README.md) — Общее описание и базовое использование  
2. [TECHNICAL.md](TECHNICAL.md) — Технические детали реализации  
3. [TESTING.md](TESTING.md) — Процедуры и сценарии тестирования  
4. [USAGE.md](USAGE.md) — Руководство по интеграции и использованию  

## Быстрая справка

### Назначение контракта

Смарт-контракт P2P Escrow обеспечивает безопасные транзакции между покупателями и продавцами в блокчейне TON под контролем модератора. Он предоставляет:

- Эскроу-функциональность для P2P-сделок  
- Идентификацию сделок по метке (memo)  
- Сбор комиссии  
- Возможность разрешения споров  

### Основные операции

| Операция             | Код операции | Описание                                                  |
|----------------------|--------------|------------------------------------------------------------|
| Создать сделку       | 1            | Создаёт новую эскроу-сделку между покупателем и продавцом |
| Пополнить сделку     | 5            | Покупатель пополняет сделку                               |
| Разрешить сделку     | 2            | Модератор завершает сделку: перевод продавцу или возврат покупателю |
| Возврат без метки    | 3            | Возврат средств, отправленных без правильной метки        |
| Вывод комиссий       | 4            | Вывод накопленных комиссий                                |

### Get-методы

| Метод                     | Описание                                             |
|--------------------------|------------------------------------------------------|
| get_deal_info(deal_id)   | Возвращает информацию о конкретной сделке            |
| get_deal_counter()       | Возвращает текущее значение счётчика сделок          |

### Основной сценарий использования

1. **Создание сделки**: Модератор создаёт сделку с указанием адресов покупателя и продавца, суммы и метки (memo)  
2. **Пополнение сделки**: Покупатель пополняет сделку, отправляя TON и комиссию с меткой  
3. **Разрешение сделки**: Модератор завершает сделку, переводя средства продавцу или возвращая покупателю  

### Тестирование

Запуск автоматических тестов:

```bash
npm test
```

Для подробных инструкций см. файл [TESTING.md](TESTING.md).

### Развёртывание

Развёртывание в тестовой сети:

```bash
npm run bp deploy --network testnet
```

Для подробных инструкций по развёртыванию см. [USAGE.md](USAGE.md).

## Состояние контракта

Контракт поддерживает следующие состояния:

- `deals_counter`: Счётчик для генерации уникальных идентификаторов сделок  
- `deals_dict`: Словарь, хранящий данные по сделкам  
- `memo_map`: Словарь, сопоставляющий хеши меток и идентификаторы сделок  
- `unknown_funds`: Словарь средств, отправленных без метки  
- `moderator_address`: Адрес модератора  
- `commissions_pool`: Накопленные комиссии  

## Ставки комиссии

- С меткой: 3%  
- Без метки (неизвестные средства): 3%  

## Соображения по безопасности

- Контракт использует хеши меток для идентификации сделок и обеспечения их уникальности  
- Средства передаются только по решению модератора  
- В контракте предусмотрены проверки на дублирование меток  
- Пополнение возможно только при точном соответствии суммы и комиссии  

Для подробной информации о безопасности см. [TECHNICAL.md](TECHNICAL.md).

## Примеры интеграции

Документация содержит примеры интеграции для:

- Node.js-бэкендов  
- Express.js-серверов  
- React.js-фронтендов  

Для подробных примеров интеграции см. [USAGE.md](USAGE.md).

## Частые сценарии использования

Документация охватывает следующие сценарии:

1. **Онлайн-маркетплейс**: Безопасные транзакции между покупателями и продавцами  
2. **Фриланс-услуги**: Безопасная оплата за выполненную работу  
3. **Задатки при покупке недвижимости**: Безопасное депонирование средств  

Для подробностей см. [USAGE.md](USAGE.md).

## Лучшие практики

Основные рекомендации:

- Безопасное управление ключами модератора  
- Генерация уникальных меток  
- Валидация адресов  
- Обработка ошибок  
- Мониторинг транзакций  

Для подробных рекомендаций см. [USAGE.md](USAGE.md).

## Устранение неполадок

Распространённые проблемы и их решения описаны в [USAGE.md](USAGE.md).

## Будущие улучшения

Возможные улучшения включают:

- Функциональность истечения срока действия сделок  
- Мультиподписи  
- Расширенные механизмы разрешения споров  
- Переменные ставки комиссии  
- Поддержка различных типов эскроу  

Для подробностей см. [TECHNICAL.md](TECHNICAL.md).

--- 

